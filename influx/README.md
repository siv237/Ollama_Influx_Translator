# Утилита для тестирования Flux-запросов (`run_flux.sh`)

Этот скрипт предназначен для локального тестирования Flux-запросов перед их использованием в Grafana. Он полностью имитирует поведение Grafana, подставляя в запрос необходимые переменные.

## Зависимости

1.  **`curl`**: Утилита для выполнения HTTP-запросов.
2.  **`config.env`**: Файл конфигурации в корне проекта. Скрипт ожидает найти в нем следующие переменные:
    - `INFLUXDB_URL`
    - `INFLUXDB_TOKEN`
    - `INFLUXDB_ORG`

## Использование

Скрипт поддерживает несколько необязательных флагов для гибкой настройки.

```bash
./run_flux.sh [--host <host>] [--start <start>] [--stop <stop>] <файл.flux>
```

### Аргументы

-   `--host <имя_хоста>` (или `-h`): Задать имя хоста вручную. По умолчанию используется системный `hostname`.
-   `--start <время>` (или `-s`): Установить начало временного диапазона. По умолчанию: `-24h`.
-   `--stop <время>` (или `-e`): Установить конец временного диапазона. По умолчанию: `now()`.
-   `<файл.flux>`: **(Обязательно)** Путь к файлу с Flux-запросом.

### Примеры

1.  **Стандартный запуск (последние 24 часа):**
    ```bash
    ./run_flux.sh step10-original.flux
    ```

2.  **Запуск с кастомным хостом:**
    ```bash
    ./run_flux.sh --host my-test-machine step10-original.flux
    ```

3.  **Запуск за последний час:**
    ```bash
    ./run_flux.sh --start -1h step10-original.flux
    ```

4.  **Запуск с полным набором флагов:**
    ```bash
    ./run_flux.sh --host test-pc --start -2d --stop -1d step10-original.flux
    ```

5.  **Запуск с точным временным интервалом (формат RFC3339):**
    ```bash
    ./run_flux.sh --start 2025-07-29T14:19:32Z --stop 2025-07-29T14:19:33Z step10-original.flux
    ```

## Как это работает?

Скрипт выполняет следующие действия:
1.  Разбирает аргументы командной строки для определения хоста и временного диапазона.
2.  Читает переменные из `config.env`.
3.  Читает содержимое указанного `.flux` файла.
4.  Заменяет плейсхолдеры Grafana (`${host}`, `v.timeRangeStart`, `v.timeRangeStop`) на реальные значения.
5.  Отправляет обработанный запрос в InfluxDB с помощью `curl` и выводит результат.
